import*as e from"pigpio";import{Gpio as i}from"pigpio";class t{static#interval=100;static#chars={};static#segments=[new i(16,{mode:i.OUTPUT}),new i(12,{mode:i.OUTPUT}),new i(25,{mode:i.OUTPUT}),new i(8,{mode:i.OUTPUT}),new i(7,{mode:i.OUTPUT}),new i(20,{mode:i.OUTPUT}),new i(21,{mode:i.OUTPUT})];static#positions=[new i(10,{mode:i.OUTPUT}),new i(9,{mode:i.OUTPUT}),new i(11,{mode:i.OUTPUT}),new i(5,{mode:i.OUTPUT}),new i(6,{mode:i.OUTPUT}),new i(13,{mode:i.OUTPUT}),new i(19,{mode:i.OUTPUT}),new i(26,{mode:i.OUTPUT})];static#positionsEnabled=[0,1,2,3,4,5,6,7];static#positionsChar=["","","","","","","",""];static#positionIndex=-1;static#keysIn=[new i(2,{mode:i.INPUT,pullUpDown:i.PUD_UP}),new i(3,{mode:i.INPUT,pullUpDown:i.PUD_UP}),new i(4,{mode:i.INPUT,pullUpDown:i.PUD_UP}),new i(17,{mode:i.INPUT,pullUpDown:i.PUD_UP})];static#keysOut=[new i(14,{mode:i.OUTPUT}),new i(15,{mode:i.OUTPUT}),new i(18,{mode:i.OUTPUT}),new i(23,{mode:i.OUTPUT})];static#keypad={0:{0:"9",1:"hit",2:"",3:""},1:{0:"6",1:"7",2:"8",3:""},2:{0:"3",1:"4",2:"5",3:""},3:{0:"0",1:"1",2:"2",3:"reset"}};static#key="";static#keyEventStore=[];static#run=!1;static#init=!1;static#exit=!1;static#lapDigit=()=>{this.#positionIndex>=this.#positionsEnabled.length-1?this.#positionIndex=0:this.#positionIndex+=1,this.#positionsEnabled.forEach(i=>{this.#positions[i].digitalWrite(1)});var i=this.#positionsChar[this.#positionsEnabled[this.#positionIndex]];const s=this.#chars[i];void 0!==s&&(this.#segments.forEach((i,t)=>{i.digitalWrite(s[t])}),this.#positions[this.#positionsEnabled[this.#positionIndex]].digitalWrite(0))};static#lapKey=()=>{this.#keysOut.forEach((i,s,t)=>{t.forEach(i=>{i.digitalWrite(1)}),i.digitalWrite(0),this.#keysIn.forEach((i,t)=>{t=this.#keypad[s][t];0===i.digitalRead()&&""===this.#key?this.#key=t:1===i.digitalRead()&&this.#key===t&&""!==this.#key&&(this.#keyEventStore.forEach(i=>{i(this.#key)}),this.#key="")})})};static#loop=()=>{this.#run&&(this.#lapDigit(),this.#lapKey()),this.#exit||setTimeout(()=>{this.#loop()},this.#interval)};static init=(i,t,s)=>{if(this.#init)throw new Error("AtariJukebox is already init.");e.initialize(),this.#positions.forEach(i=>{i.digitalWrite(0)}),this.#segments.forEach(i=>{i.digitalWrite(0)}),this.#keysOut.forEach(i=>{i.digitalWrite(0)}),this.#interval=i,Object.entries(t).forEach(([i,t])=>{this.#chars[i]=t}),this.#positionsEnabled=[],s.forEach(({defaultChar:i,disabled:t},s)=>{!0!==t?this.#positionsEnabled.push(s):this.#positions[s].digitalWrite(1),this.#positionsChar[s]=void 0!==i?i:""}),this.#init=!0,this.#loop()};static start=()=>{this.#run=!0};static keypadEvent=i=>{this.#keyEventStore.push(i)};static setChar=(i,t)=>{void 0!==this.#chars[t]&&(this.#positionsChar[i]=t)};static pause=()=>{this.#run=!1};static kill=()=>{this.#run=!1,this.#exit=!0,this.#positions.forEach(i=>{i.digitalWrite(0)}),this.#segments.forEach(i=>{i.digitalWrite(0)}),this.#keysOut.forEach(i=>{i.digitalWrite(0)}),e.terminate()}}export default t;export{t as AtariJukeboxGpio};